<!DOCTYPE html>

<html>
<head>
  <title>app.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="app.html">
                app.js
              </a>
            
              
              <a class="source" href="add-performance.html">
                add-performance.js
              </a>
            
              
              <a class="source" href="edit-event.html">
                edit-event.js
              </a>
            
              
              <a class="source" href="edit-member.html">
                edit-member.js
              </a>
            
              
              <a class="source" href="edit-performance.html">
                edit-performance.js
              </a>
            
              
              <a class="source" href="edit-person.html">
                edit-person.js
              </a>
            
              
              <a class="source" href="event.html">
                event.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="header.html">
                header.js
              </a>
            
              
              <a class="source" href="login.html">
                login.js
              </a>
            
              
              <a class="source" href="main.html">
                main.js
              </a>
            
              
              <a class="source" href="members.html">
                members.js
              </a>
            
              
              <a class="source" href="performance.html">
                performance.js
              </a>
            
              
              <a class="source" href="speakers.html">
                speakers.js
              </a>
            
              
              <a class="source" href="sponsors.html">
                sponsors.js
              </a>
            
              
              <a class="source" href="calendar.html">
                calendar.js
              </a>
            
              
              <a class="source" href="services.html">
                services.js
              </a>
            
              
              <a class="source" href="angular-locale_fr-fr.html">
                angular-locale_fr-fr.js
              </a>
            
              
              <a class="source" href="datepicker.html">
                datepicker.js
              </a>
            
              
              <a class="source" href="ui-events.html">
                ui-events.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>app.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">'use strict'</span>;

<span class="hljs-comment">/**
 * Main app module
 */</span>
<span class="hljs-keyword">var</span> app = angular.module(<span class="hljs-string">'ippeventsApp'</span>, [
  <span class="hljs-string">'homeServices'</span>,
  <span class="hljs-string">'connectionServices'</span>,
  <span class="hljs-string">'eventsServices'</span>,
  <span class="hljs-string">'performancesServices'</span>,
  <span class="hljs-string">'membersServices'</span>,
  <span class="hljs-string">'personsServices'</span>,
  <span class="hljs-string">'speakersServices'</span>,
  <span class="hljs-string">'eventUI'</span>,
  <span class="hljs-string">'ui.date'</span>,
  <span class="hljs-string">'calendar-ui'</span>,
  <span class="hljs-string">'ngCookies'</span>]);

app.filter(<span class="hljs-string">'range'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(input, total)</span> {</span>
    total = <span class="hljs-built_in">parseInt</span>(total);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;total; i++)
      input.push(i);
    <span class="hljs-keyword">return</span> input;
  };
});


<span class="hljs-comment">/**
 * Youpi tralalalala
 */</span>
app.config(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($httpProvider)</span> {</span>
  $httpProvider.defaults.withCredentials = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">var</span> interceptor = [<span class="hljs-string">'$rootScope'</span>,<span class="hljs-string">'$q'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scope, $q)</span> {</span>
 
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">success</span><span class="hljs-params">(response)</span> {</span>
      <span class="hljs-keyword">return</span> response;
    }
 
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span><span class="hljs-params">(response)</span> {</span>
      <span class="hljs-keyword">var</span> status = response.status;

      <span class="hljs-keyword">if</span> (status == <span class="hljs-number">403</span>) {
        <span class="hljs-keyword">var</span> deferred = $q.defer();
        <span class="hljs-keyword">var</span> req = {
          config: response.config,
          deferred: deferred
        }
        scope.requests403.push(req);
        scope.$broadcast(<span class="hljs-string">'event:loginRequired'</span>);
        <span class="hljs-keyword">return</span> deferred.promise;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>otherwise</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> $q.reject(response);

    }

    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(promise)</span> {</span>
      <span class="hljs-keyword">return</span> promise.then(success, error);
    }

  }];
  $httpProvider.responseInterceptors.push(interceptor);
});

app.config(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">($routeProvider)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>var access = routingConfig.accessLevels;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  $routeProvider
  .when(<span class="hljs-string">'/'</span>, {
    templateUrl: <span class="hljs-string">'views/main.html'</span>,
    controller: <span class="hljs-string">'MainCtrl'</span>
  })
  .when(<span class="hljs-string">'/login'</span>, {
    templateUrl: <span class="hljs-string">'views/login.html'</span>,
    controller: <span class="hljs-string">'LoginCtrl'</span>
  })
  .when(<span class="hljs-string">'/members'</span>, {
    templateUrl: <span class="hljs-string">'views/members.html'</span>,
    controller: <span class="hljs-string">'MembersCtrl'</span>
  })
  .when(<span class="hljs-string">'/edit-member'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-member.html'</span>,
    controller: <span class="hljs-string">'EditMemberCtrl'</span>
  })
  .when(<span class="hljs-string">'/edit-member/:id'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-member.html'</span>,
    controller: <span class="hljs-string">'EditMemberCtrl'</span>
  })
  <span class="hljs-comment">/*.when('/persons', {
    templateUrl: 'views/persons.html',
    controller: 'PersonsCtrl'
  })*/</span>
  .when(<span class="hljs-string">'/edit-person'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-person.html'</span>,
    controller: <span class="hljs-string">'EditPersonCtrl'</span>
  })
  .when(<span class="hljs-string">'/edit-person/:id'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-person.html'</span>,
    controller: <span class="hljs-string">'EditPersonCtrl'</span>
  })
  .when(<span class="hljs-string">'/events'</span>, {
    templateUrl: <span class="hljs-string">'views/events.html'</span>,
    controller: <span class="hljs-string">'EventsCtrl'</span>
  })
  .when(<span class="hljs-string">'/edit-event'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-event.html'</span>,
    controller: <span class="hljs-string">'EditEventCtrl'</span>
  })
  .when(<span class="hljs-string">'/edit-event/:id'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-event.html'</span>,
    controller: <span class="hljs-string">'EditEventCtrl'</span>
  })
  .when(<span class="hljs-string">'/event/:id'</span>, {
    templateUrl: <span class="hljs-string">'views/event.html'</span>,
    controller: <span class="hljs-string">'EventCtrl'</span>
  })
  .when(<span class="hljs-string">'/event/:event_id/edit-performance/:performance_id'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-performance.html'</span>,
    controller: <span class="hljs-string">'EditPerformanceCtrl'</span>
  })
  .when(<span class="hljs-string">'/add-performance/:event_id'</span>, {
    templateUrl: <span class="hljs-string">'views/add-performance.html'</span>,
    controller: <span class="hljs-string">'AddPerformanceCtrl'</span>
  })
  .when(<span class="hljs-string">'/event/:event_id/performance/:id'</span>, {
    templateUrl: <span class="hljs-string">'views/performance.html'</span>,
    controller: <span class="hljs-string">'PerformanceCtrl'</span>
  })
  .when(<span class="hljs-string">'/event/:event_id/performance/:performance_id/inscription'</span>, {
    templateUrl: <span class="hljs-string">'views/edit-person.html'</span>,
    controller: <span class="hljs-string">'EditPerformanceCtrl'</span>
  })
  .when(<span class="hljs-string">'/speakers'</span>, {
    templateUrl: <span class="hljs-string">'views/speakers.html'</span>,
    controller: <span class="hljs-string">'SpeakersCtrl'</span>
  })
  .when(<span class="hljs-string">'/getPerformancesBySpeaker/:nom/:prenom'</span>, {
    templateUrl: <span class="hljs-string">'views/performancesBySpeaker.html'</span>,
    controller: <span class="hljs-string">'PerformancesSpeakerCtrl'</span>
  })
  .otherwise({
    redirectTo: <span class="hljs-string">'/'</span>
  });
  
});

app.run([<span class="hljs-string">'$rootScope'</span>, <span class="hljs-string">'$http'</span>, <span class="hljs-string">'$location'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(scope, $http, $location)</span> {</span>

  <span class="hljs-comment">/**
   * Holds all the requests which failed due to 401 response.
   */</span>
  scope.requests403 = [];
 
  <span class="hljs-comment">/**
   * On 'event:loginConfirmed', resend all the 401 requests.
   */</span>
  scope.$on(<span class="hljs-string">'event:loginRequired'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
     $location.path(<span class="hljs-string">"login"</span>);
   });
 
  scope.$on(<span class="hljs-string">'event:loginConfirmed'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">var</span> i, requests = scope.requests403;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; requests.length; i++) {
      retry(requests[i]);
    }
    scope.requests403 = [];
 
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retry</span><span class="hljs-params">(req)</span> {</span>
      $http(req.config).then(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(response)</span> {</span>
        req.deferred.resolve(response);
      });
    }
  });
 
  <span class="hljs-comment">/**
   * On 'event:loginRequest' send credentials to the server.
   */</span>
  scope.$on(<span class="hljs-string">'event:loginRequest'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event, username, password)</span> {</span>
    <span class="hljs-keyword">var</span> payload = $.param({j_username: username, j_password: password});
    <span class="hljs-keyword">var</span> config = {
      headers: {<span class="hljs-string">'Content-Type'</span>:<span class="hljs-string">'application/x-www-form-urlencoded; charset=UTF-8'</span>}
    }
    $http.post(<span class="hljs-string">'j_spring_security_check'</span>, payload, config).success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> {</span>
      <span class="hljs-keyword">if</span> (data === <span class="hljs-string">'AUTHENTICATION_SUCCESS'</span>) {
        scope.$broadcast(<span class="hljs-string">'event:loginConfirmed'</span>);
      }
    });
  });
 
  <span class="hljs-comment">/**
   * On 'logoutRequest' invoke logout on the server and broadcast 'event:loginRequired'.
   */</span>
  scope.$on(<span class="hljs-string">'event:logoutRequest'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
    $http.put(<span class="hljs-string">'j_spring_security_logout'</span>, {}).success(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      ping();
    });
  });
 
  <span class="hljs-comment">/**
   * Ping server to figure out if user is already logged in.
   */</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ping</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>console.log(‘PING’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/*
    $http.get('rest/ping').success(function() {
      scope.$broadcast('event:loginConfirmed');
    });*/</span>
  }
  ping();
 
}]);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
